
var ColinearityEquation = require('colinearityEquation')

var vector = require('vector')

// interior oreintal parameter is same for a camera.
var iop = [
    0.0419,  // xp
    -0.0169,  // yp
    3.9845  // c
]

iop.k = [-6.9954e-03, 7.7051e-04, -7.5490e-51]
iop.p = [0,0]

// exterior oriental parameter different for every photo. 
var eops = {
'IMG_20170329_142042.jpg': { xo:80.3735,yo:98.8612,zo:634.6268,omega:0.0699,phi:-0.1030,kappa:2.8744 },
'IMG_20170329_142058.jpg': { xo:-81.3278,yo:41.9777,zo:565.2236,omega:0.0803,phi:-0.1067,kappa:-0.2924 },
'IMG_20170329_142125.jpg': { xo:-60.7716,yo:54.6448,zo:568.3118,omega:0.0760,phi:-0.0883,kappa:-0.2558 },
'IMG_20170329_142211.jpg': { xo:-63.6876,yo:53.5254,zo:563.7600,omega:0.0823,phi:-0.1150,kappa:-0.2806 },
'IMG_20170329_142226.jpg': { xo:94.7702,yo:70.3780,zo:642.3514,omega:0.0971,phi:-0.1026,kappa:-0.2595 },
'IMG_20170329_142240.jpg': { xo:198.1424,yo:-45.8818,zo:642.4837,omega:0.0804,phi:-0.0992,kappa:-0.2667 },
'IMG_20170329_142246.jpg': { xo:245.7583,yo:99.4521,zo:612.2858,omega:0.1071,phi:-0.1272,kappa:-0.2700 },
'IMG_20170329_142256.jpg': { xo:-26.7946,yo:180.4271,zo:574.0153,omega:0.1017,phi:-0.1120,kappa:-0.2647 },
'IMG_20170329_142310.jpg': { xo:-49.1470,yo:-490.1662,zo:566.5798,omega:0.7712,phi:-0.2354,kappa:-0.1636 },
'IMG_20170329_142320.jpg': { xo:7.0833,yo:-288.2811,zo:415.5978,omega:0.6416,phi:-0.1638,kappa:-1.7378 },
'IMG_20170329_142351.jpg': { xo:350.0767,yo:-173.1544,zo:421.5505,omega:0.4956,phi:0.4160,kappa:0.6646 },
'IMG_20170329_142410.jpg': { xo:388.6816,yo:-154.1689,zo:406.4552,omega:0.4400,phi:0.3880,kappa:-0.9799 },
'IMG_20170329_142420.jpg': { xo:556.9654,yo:4.5911,zo:451.8812,omega:0.2307,phi:0.6087,kappa:1.2424 },
'IMG_20170329_142427.jpg': { xo:500.2165,yo:68.7566,zo:437.8002,omega:0.1262,phi:0.5121,kappa:-0.2832 },
'IMG_20170329_142538.jpg': { xo:489.6227,yo:29.9134,zo:464.3364,omega:0.1353,phi:0.4847,kappa:-0.2866 },
'IMG_20170329_142549.jpg': { xo:497.3857,yo:384.8003,zo:452.6594,omega:-0.4250,phi:0.4969,kappa:2.3210 },
'IMG_20170329_142559.jpg': { xo:482.4185,yo:346.0830,zo:445.1147,omega:-0.2945,phi:0.4102,kappa:0.5590 },
'IMG_20170329_142609.jpg': { xo:209.8006,yo:558.7553,zo:447.6300,omega:-0.6788,phi:0.1314,kappa:2.9426 },
'IMG_20170329_142617.jpg': { xo:194.5429,yo:453.3786,zo:424.2831,omega:-0.4988,phi:0.0898,kappa:1.3428 },
'IMG_20170329_142631.jpg': { xo:-138.6037,yo:472.4225,zo:438.5183,omega:-0.6256,phi:-0.4197,kappa:-2.6275 },
'IMG_20170329_142643.jpg': { xo:-155.7618,yo:455.2740,zo:448.2140,omega:-0.4164,phi:-0.3791,kappa:2.2390 },
'IMG_20170329_142700.jpg': { xo:-397.3214,yo:419.4585,zo:461.9035,omega:-0.4366,phi:-0.6747,kappa:-2.0535 },
'IMG_20170329_142713.jpg': { xo:-171.5418,yo:312.4181,zo:392.4090,omega:-0.3752,phi:-0.6533,kappa:-1.9438 },
'IMG_20170329_142724.jpg': { xo:-209.6607,yo:294.3682,zo:427.5768,omega:-0.3086,phi:-0.4600,kappa:2.8210 },
'IMG_20170329_142739.jpg': { xo:-332.1590,yo:-77.8331,zo:436.8272,omega:0.3233,phi:-0.6313,kappa:-0.9429 },
'IMG_20170329_142744.jpg': { xo:-253.1373,yo:-83.4696,zo:438.5719,omega:0.2580,phi:-0.5070,kappa:-2.4429 }
}

// ground point position. 
var points = {
'WONB48_3': [355.713100, -30.126700, 9.142200],
'WONB5_1': [413.113000, 158.337400, 12.260600],
'WONB5_B1': [414.818600, 166.727400, 12.469900],
'WONB5_B4': [416.544900, 175.095900, 12.559100],
'WONB48_2': [348.464800, -25.509700, 9.034200],
'WONB48_B10': [339.209900, -48.656800, 8.629400],
'WONB5_2': [404.658000, 160.096600, 12.088800],
'WONB34_3': [374.423000, 62.016500, 10.114800],
'WONB48': [343.855100, -32.790600, 9.189100],
'WONB5': [406.409500, 168.488100, 12.202200],
'WONB5_5': [408.150600, 176.901100, 12.301400],
'WONB48_5': [339.244900, -40.053400, 8.840700],
'WONB48_1': [341.218300, -20.903000, 9.014300],
'WONB34_B14': [363.615100, 52.627400, 10.148500],
'WONB34_2': [368.562100, 68.352900, 10.086200],
'WONB5_3': [396.283400, 161.880900, 11.813300],
'WONB5_B11': [402.643600, 183.503400, 12.217900],
'WONB48_B2': [335.499100, -30.805500, 8.977900],
'WONB48_B5': [330.900800, -38.075500, 8.543700],
'WONB34': [362.315300, 62.523000, 10.136900],
'WONB34_1': [362.757900, 74.646100, 9.892300],
'WONB34_5': [356.001800, 56.689800, 9.908100],
'WONB34_B1': [356.466900, 68.849700, 10.006500],
'WONB34_B8': [348.568100, 52.420100, 9.642100],
'WONB22_3': [388.198600, 258.613000, 12.813000],
'WONB22_2': [381.952300, 264.607200, 12.751100],
'WONB22_B13': [376.283400, 246.285900, 12.445400],
'WONB22': [376.008200, 258.367500, 12.661300],
'WONB22_1': [375.770400, 270.533500, 12.533100],
'WONB22_5': [370.082000, 252.196100, 12.305300],
'WONB22_B1': [369.854900, 264.332100, 12.651700],
'WONB22_B6': [361.592600, 253.014200, 12.169000],
'WONB38_1': [334.217200, 164.571500, 10.410100],
'WONB38_2': [330.387300, 156.885600, 10.184200],
'WONB38_3': [326.577900, 149.181900, 9.882700],
'WONB38_B1': [326.518400, 168.376200, 10.597500],
'WONB38': [322.655000, 160.696900, 10.380800],
'WONB38_B14': [313.881500, 155.992000, 10.083400],
'WONB38_5': [314.977900, 164.483400, 10.154100],
'WONB47_3': [280.998200, 67.299800, 9.477900],
'WONB42_3': [247.232500, -41.217300, 8.898900],
'WONB38_B9': [306.617700, 166.453600, 9.761000],
'WONB42_B15': [237.866000, -47.720100, 9.324400],
'WONB42_2': [242.021600, -34.378400, 9.055200],
'WONB47_2': [274.693700, 73.092600, 9.207100],
'WONB47': [268.868900, 66.765200, 9.327400],
'WONB42': [235.171300, -39.562200, 9.410800],
'WONB42_1': [236.825300, -27.527800, 9.269500],
'WONB47_5': [263.043100, 60.447800, 9.121400],
'WONB47_1': [268.386700, 78.949800, 9.106600],
'WONB47_B9': [258.791900, 52.953100, 8.994500],
'WONB42_5': [228.369100, -44.780200, 9.433200],
'WONB42_B10': [225.370000, -52.866600, 9.115300],
'WONB42_B1': [230.027600, -32.683400, 9.660800],
'WONB47_B2': [261.015000, 70.238600, 9.233800],
'WONB47_B5': [255.161200, 63.889200, 8.979500],
'WONB4_3': [292.755100, 303.158600, 9.853100],
'WONB4_2': [288.117000, 310.379600, 9.879600],
'WONB4': [280.867600, 305.694900, 9.998600],
'WONB4_1': [283.492400, 317.613100, 9.900200],
'WONB4_5': [273.609300, 301.011100, 9.919000],
'WONB4_B1': [276.238300, 312.888700, 10.110600],
'WONB4_B10': [269.938600, 293.158300, 9.736400],
'WONB4_B4': [268.974400, 308.205900, 10.047700],
'WONB9_3': [155.898700, -44.054800, 8.213300],
'WONB9_2': [152.769700, -36.009300, 7.804500],
'WONB27_3': [183.751600, 101.831300, 51.088100],
'WONB9_B15': [145.089500, -47.797100, 7.832500],
'WONB27_B12': [175.941100, 83.461900, 50.879700],
'WONB9_1': [149.653000, -27.969200, 7.521400],
'WONB9': [144.770400, -39.170600, 7.543900],
'WONB27_2': [175.765600, 105.001200, 50.864700],
'WONB9_B1': [141.628000, -31.125300, 7.327600],
'WONB27': [172.605900, 97.036000, 50.732100],
'WONB27_5': [169.429900, 89.058200, 50.583300],
'WONB9_5': [136.742300, -42.324800, 7.140000],
'WONB27_B7': [162.493600, 84.014000, 50.253500],
'WONB9_B4': [133.645600, -34.283300, 6.925500],
'WONB3_B4': [206.064900, 221.404400, 7.949700],
'WONB27_1': [167.759400, 108.175800, 50.805600],
'WONB27_B1': [164.612800, 100.197600, 50.587900],
'WONB3_B1': [202.090000, 213.833600, 7.578900],
'WONB3_1': [198.127500, 206.216700, 7.085300],
'WONB3_5': [198.486500, 225.440600, 7.485300],
'WONB3_B9': [200.660800, 233.741200, 7.542900],
'WONB3': [194.482800, 217.847500, 7.216900],
'WONB3_2': [190.504700, 210.268100, 6.912400],
'WONB3_3': [182.933000, 214.282000, 6.397300],
'WONB33_3': [124.598600, 37.365600, 4.825700],
'WONB33_2': [123.286200, 45.848000, 4.738000],
'WONB33_1': [121.908400, 54.321000, 4.522700],
'WONB33': [114.792800, 44.491400, 4.827900],
'WONB33_B1': [113.474600, 52.986500, 4.680600],
'WONB33_B13': [107.675300, 34.678700, 4.603100],
'WONB33_5': [106.371300, 43.147600, 4.372700],
'WONB33_B8': [97.806400, 43.751300, 3.580000],
'WONB20_B6': [76.706600, 178.271400, 48.578400],
'WONB20_B1': [69.404000, 166.311400, 48.668400],
'WONB20_1': [63.998700, 159.648900, 48.210300],
'WONB20_5': [68.145300, 178.384600, 48.496600],
'WONB20': [62.749400, 171.711600, 48.509200],
'WONB20_B11': [66.281800, 186.753100, 48.319900],
'WONB13_3': [8.566800, -8.611500, 0.014600],
'WONB20_2': [57.376800, 165.081800, 48.033400],
'WONB13_2': [8.608700, 0.015900, 0.000000],
'WONB13_1': [8.623100, 8.585000, -0.097100],
'WONB20_3': [50.714900, 170.478600, 47.977900],
'WONB13': [-0.000000, 0.000000, 0.000000],
'WONB13_B1': [-0.000000, 8.585500, 0.000000],
'WONB13_5': [-8.643900, -0.054000, -0.245000],
'WONB13_B11': [-13.970700, -6.788000, -0.465800],
'WONB13_B5': [-11.384700, 8.095500, -0.397200],
'WONB32_3': [-9.921700, 97.229200, -0.023200],
'WONB32_2': [-15.284400, 103.950100, -0.265500],
'WONB32': [-21.980500, 98.619600, -0.504400],
'WONB32_B12': [-25.884600, 85.170400, -0.514700],
'WONB32_1': [-20.595200, 110.642600, -0.228900],
'WONB32_5': [-28.709000, 93.255300, -0.786800],
'WONB32_B1': [-27.305300, 105.294800, -0.430600],
'WONB32_B8': [-36.443600, 89.569500, -1.007000],
'WONB37_B1': [-23.863800, 193.432900, 1.232900],
'WONB37_1': [-27.627000, 185.787700, -0.069300],
'WONB37_5': [-27.753500, 204.900400, 1.326900],
'WONB37_B9': [-25.801600, 213.227400, 0.947900],
'WONB37': [-31.552800, 197.251400, 1.025300],
'WONB37_2': [-35.284300, 189.623500, -0.316700],
'WONB37_B13': [-35.457100, 208.725600, 1.128300],
'WONB37_3': [-42.984200, 193.456200, -0.556400],
'WONB11_B5': [-30.280900, 341.912800, 0.015200],
'WONB11_B1': [-35.605900, 331.797000, -0.050300],
'WONB43_3': [-83.600300, 143.103800, -1.547000],
'WONB43_B14': [-88.009300, 129.402000, -1.433400],
'WONB11_1': [-39.915700, 324.346100, -0.461000],
'WONB43_B11': [-91.571200, 121.927600, -1.542400],
'WONB11_B9': [-36.132100, 351.718500, -0.427400],
'WONB11_5': [-38.577900, 343.537300, -0.404700],
'WONB11': [-42.939200, 336.083000, -0.470200],
'WONB43_2': [-91.877800, 145.404500, -2.023200],
'WONB43': [-94.224800, 137.139300, -1.704800],
'WONB43_5': [-96.573400, 128.856400, -1.784200],
'WONB11_2': [-47.264300, 328.672000, -0.704500],
'WONB43_1': [-100.077300, 147.738000, -2.501500],
'WONB11_3': [-54.618300, 332.974300, -1.074900],
'WONB43_B1': [-102.465200, 139.500300, -2.033800],
'WONB45_1': [-108.044200, 293.139200, -2.761800],
'WONB45_2': [-114.466000, 287.382000, -3.024300],
'WONB45_B1': [-113.823300, 299.528800, -2.616500],
'WONB45_3': [-120.834300, 281.635900, -3.142300],
'WONB45': [-120.214900, 293.777400, -3.044300],
'WONB45_B15': [-128.090700, 290.449500, -3.211600],
'WONB45_5': [-125.937300, 300.147100, -3.309700],
'WONB45_B12': [-133.831500, 296.798100, -3.511500],
'WONB49_1': [461.862100, -14.736100, 14.726500],
'WONB49_B2': [459.236000, -3.570900, 14.827800],
'WONB49_2': [453.392400, -16.240800, 14.389500],
'WONB49_B5': [457.663300, 4.940000, 14.527200],
'WONB49': [451.769700, -7.800400, 14.523400],
'WONB49_3': [444.899000, -17.817700, 14.054000],
'WONB49_5': [450.208200, 0.682900, 14.316400],
'WONB49_B11': [442.589500, 4.703800, 13.814300],
'WONB25_3': [183.447000, 305.338800, 6.591300],
'WONB25_2': [180.495700, 313.402400, 6.510400],
'WONB25_1': [177.572400, 321.436100, 6.333500],
'WONB25': [172.456100, 310.442500, 6.520400],
'WONB25_B1': [169.498700, 318.466700, 6.443400],
'WONB25_5': [164.399200, 307.475400, 6.135900],
'WONB25_B10': [159.192300, 300.653600, 5.792800],
'WONB25_B7': [156.054400, 309.260700, 5.670300],
'WONB46_3': [47.900500, 298.768700, 2.384400],
'WONB46_2': [48.886200, 307.290200, 2.303100],
'WONB46_1': [49.914700, 315.743500, 2.227700],
'WONB46': [40.369200, 308.259600, 2.369000],
'WONB46_B2': [38.540100, 316.592800, 2.275400],
'WONB46_5': [31.811800, 309.269900, 1.932500],
'WONB46_B5': [29.996000, 317.576500, 1.738200],
'WONB46_B8': [23.709100, 312.178300, 1.538400],
'WONB35_B8': [-175.539200, 177.758300, -4.826900],
'WONB35_5': [-167.151600, 179.600300, -4.132400],
'WONB35_B1': [-163.094800, 191.041800, -3.953500],
'WONB15_1': [-192.450000, 78.255000, -5.123200],
'WONB15_B1': [-192.031000, 69.693700, -4.643200],
'WONB35': [-159.481800, 183.275700, -3.674500],
'WONB35_1': [-155.405900, 194.688900, -3.768400],
'WONB15_B5': [-190.994700, 58.375800, -4.766400],
'WONB35_B15': [-158.574800, 174.745100, -3.526900],
'WONB15_2': [-183.854400, 78.641400, -4.882400],
'WONB35_2': [-151.749700, 186.980100, -3.615100],
'WONB15': [-183.492100, 70.103900, -4.606600],
'WONB15_5': [-183.051200, 61.544400, -4.721300],
'WONB35_3': [-148.096800, 179.186900, -3.441400],
'WONB15_3': [-175.323700, 79.088300, -4.724800],
'WONB15_B13': [-174.509500, 61.965800, -4.717300],
'WONB10_B8': [-144.386700, -9.725300, -3.132800],
'WONB10_B5': [-140.959100, -2.165300, -2.964200],
'WONB10_5': [-135.838100, -9.035400, -2.666000],
'WONB10_B1': [-130.231100, 1.795900, -2.295800],
'WONB10': [-127.678800, -6.430500, -2.190800],
'WONB10_1': [-122.071300, 4.372300, -1.924400],
'WONB10_2': [-119.469000, -3.820900, -1.950800],
'WONB10_3': [-116.860700, -12.024800, -1.929900],
'WONB8_B4': [-55.187700, -58.601800, -0.436200],
'WONB8_5': [-54.940000, -67.166100, -1.230300],
'WONB8_B14': [-51.961600, -75.176800, -1.848500],
'WONB8_B1': [-46.605600, -58.357100, -0.487400],
'WONB8': [-46.373500, -66.924700, -1.014200],
'WONB8_1': [-38.056200, -58.046900, -1.036200],
'WONB8_2': [-37.756200, -66.628500, -1.277600],
'WONB8_3': [-37.512600, -75.235600, -1.645600],
'WONB2_B4': [38.704000, -87.568200, 1.648700],
'WONB2_B1': [42.425200, -79.829600, 2.173000],
'WONB2_1': [46.164700, -72.105200, 2.350400],
'WONB2_B8': [41.039200, -98.030600, 1.646200],
'WONB2_5': [46.477100, -91.352700, 2.275400],
'WONB2': [50.154600, -83.638800, 2.822900],
'WONB2_2': [53.903400, -75.908000, 3.078500],
'WONB2_3': [61.628600, -79.705800, 3.851900],
'WONB44_B1': [491.061500, 181.139200, 16.747300],
'WONB44_1': [496.033800, 188.156000, 16.521000],
'WONB44_5': [493.065500, 169.064300, 16.766500],
'WONB44': [498.079900, 176.163500, 17.070000],
'WONB44_2': [503.142500, 183.178700, 16.763000],
'WONB44_B11': [495.641500, 160.908500, 16.674200],
'WONB44_B15': [503.133500, 169.155000, 17.384800],
'WONB44_3': [510.281400, 178.311900, 17.039300],
'WONB19_B6': [509.438800, 242.224500, 17.627500],
'WONB19_B1': [517.794400, 253.424600, 18.432400],
'WONB19_1': [523.847500, 259.543200, 18.218400],
'WONB19_5': [517.991900, 241.265900, 18.139300],
'WONB19_B10': [516.136700, 232.906300, 17.758900],
'WONB19': [523.975600, 247.440500, 18.868600],
'WONB19_2': [530.077300, 253.588400, 18.787200],
'WONB19_3': [536.194800, 247.532500, 18.669900],
'WONB41_B10': [404.046500, -101.398700, 12.382200],
'WONB41_5': [412.603200, -101.918100, 12.848600],
'WONB41_B14': [410.157700, -110.160700, 12.965600],
'WONB41': [419.685800, -107.020400, 13.199900],
'WONB41_B1': [424.596400, -99.940200, 13.535200],
'WONB41_3': [421.671200, -119.054600, 13.266800],
'WONB41_2': [426.634900, -111.998700, 13.532300],
'WONB41_1': [431.676600, -105.213800, 13.818700],
'WONB21_B12': [461.676500, 95.112800, 15.038600],
'WONB21_B6': [467.164900, 109.084100, 15.140400],
'WONB21_5': [468.234200, 100.598300, 15.201400],
'WONB21': [475.599400, 96.201500, 15.825700],
'WONB21_B1': [479.996500, 103.538900, 16.175900],
'WONB21_3': [478.465400, 84.409900, 15.956100],
'WONB21_2': [482.901600, 91.777600, 16.181700],
'WONB21_1': [487.316500, 99.121600, 16.557300],
'WONB31_B1': [176.401600, -136.691500, 7.974200],
'WONB31_1': [180.582500, -129.202100, 7.866700],
'WONB31_B8': [173.905200, -154.671800, 7.984800],
'WONB31_5': [179.695100, -148.376100, 7.985900],
'WONB31': [183.876200, -140.828200, 7.969100],
'WONB31_2': [188.115700, -133.449500, 7.788400],
'WONB31_B11': [182.944300, -156.255600, 7.917700],
'WONB31_3': [195.581700, -137.547200, 7.626400],
'WONB14_B5': [284.962200, -99.436700, 7.600300],
'WONB14_5': [291.024800, -105.453500, 7.795100],
'WONB14_B1': [294.957100, -93.944500, 8.056500],
'WONB14_B12': [292.151300, -114.030900, 7.856200],
'WONB14': [298.726200, -101.630800, 8.148400],
'WONB14_1': [302.684300, -90.106800, 7.516900],
'WONB14_2': [306.455300, -97.826500, 7.714200],
'WONB14_3': [310.246400, -105.558700, 7.672600],
'WONB30_B7': [92.930800, 380.671000, 3.502000],
'WONB30_5': [98.723900, 374.294800, 3.936600],
'WONB30_B15': [102.122600, 364.922400, 4.241700],
'WONB30': [106.968500, 372.067900, 4.413600],
'WONB30_B1': [109.239100, 380.350800, 4.408800],
'WONB30_3': [112.930000, 361.473800, 4.276500],
'WONB30_2': [115.246700, 369.830300, 4.414000],
'WONB30_1': [117.499300, 378.126200, 4.486100],
'WONB1_5': [-98.711700, 460.659500, -1.533300],
'WONB1_B7': [-96.207300, 468.566100, -1.379600],
'WONB1_3': [-102.104400, 441.818700, -2.153000],
'WONB1': [-96.320300, 452.433400, -1.408000],
'WONB1_B4': [-90.578700, 463.042900, -0.940600],
'WONB1_2': [-93.912900, 444.227700, -1.528100],
'WONB1_B1': [-88.138900, 454.857600, -0.849800],
'WONB1_1': [-85.703000, 446.573300, -1.219100],
'WONB18_3': [-138.539600, -117.022400, -2.867200],
'WONB18_B9': [-131.834400, -91.534800, -2.503800],
'WONB18_5': [-129.959200, -99.900300, -2.301700],
'WONB18': [-129.937300, -108.461200, -2.201900],
'WONB18_2': [-130.021900, -117.084300, -2.455100],
'WONB18_B6': [-123.210100, -94.581400, -2.155200],
'WONB18_B1': [-121.407500, -108.486000, -1.816700],
'WONB18_1': [-121.478800, -117.046300, -2.205400],
'WONB23_B6': [-26.593200, -144.939800, -0.686700],
'WONB23_5': [-22.145200, -152.252700, -0.080700],
'WONB23_B14': [-20.402700, -160.620800, 0.136900],
'WONB23_B1': [-12.634300, -144.657500, -0.075500],
'WONB23': [-13.630100, -153.238800, 0.265600],
'WONB23_1': [-4.095100, -145.718400, -0.248000],
'WONB23_2': [-5.144700, -154.216200, 0.165000],
'WONB23_3': [-6.259500, -162.784300, 0.348600],
'WONB26_B7': [154.463400, 418.517400, 5.729000],
'WONB26_B1': [159.591700, 433.894600, 6.667500],
'WONB26_1': [164.142300, 441.086000, 6.529000],
'WONB26_5': [162.219600, 422.015000, 6.353100],
'WONB26': [166.791300, 429.271200, 6.893400],
'WONB26_B11': [164.995400, 413.914500, 6.244600],
'WONB26_2': [171.428200, 436.466000, 6.945100],
'WONB26_3': [178.635200, 431.877300, 7.086600],
'WONB12_B5': [94.281000, -171.058200, 5.611800],
'WONB12_B10': [95.301700, -184.504400, 5.103200],
'WONB12_5': [100.167000, -177.313500, 5.728000],
'WONB12_B1': [104.480600, -165.963600, 6.495000],
'WONB12': [107.940800, -173.875400, 6.398900],
'WONB12_1': [112.257000, -162.470900, 6.577600],
'WONB12_2': [115.858000, -170.306500, 6.484700],
'WONB12_3': [119.284200, -178.164300, 6.433200],
'WONB17_B5': [441.426100, 341.697000, 14.831100],
'WONB17_5': [449.631300, 339.049800, 15.182400],
'WONB17': [454.669400, 345.901900, 15.533300],
'WONB7_B13': [234.571400, -204.499900, 6.549600],
'WONB7_5': [243.135400, -203.909700, 6.053400],
'WONB7_3': [235.818300, -221.619000, 7.175700],
'WONB7': [243.766200, -212.401400, 6.438600],
'WONB7_B4': [251.675600, -203.289400, 5.812000],
'WONB7_2': [244.402500, -220.968600, 6.891200],
'WONB7_B1': [252.392800, -211.698200, 6.234300],
'WONB7_1': [252.990300, -220.300800, 6.558100],
'WONB6_B1': [-238.756400, -52.488700, -5.308400],
'WONB6': [-230.238800, -53.628600, -5.571400],
'WONB6_2': [-229.027500, -45.084500, -5.603100],
'WONB6_3': [-220.482000, -46.151600, -5.696600],
'WONB40_B1': [235.494900, 405.572700, 8.366200],
'WONB40_1': [239.202000, 413.276900, 8.378700],
'WONB40_5': [239.590000, 394.139600, 8.363800],
'WONB40': [243.237600, 401.858900, 8.497600],
'WONB40_2': [247.015500, 409.605700, 8.523100],
'WONB40_B10': [240.608600, 385.651100, 8.285600],
'WONB40_B13': [247.283000, 390.414600, 8.765600],
'WONB40_3': [254.694100, 405.873700, 9.076900],
'WONB29_B7': [338.370200, 366.806400, 11.791200],
'WONB29_B1': [346.694200, 380.670800, 12.213700],
'WONB29_1': [352.610400, 386.692400, 11.951200],
'WONB29_5': [346.637100, 368.561800, 12.055500],
'WONB29': [352.729500, 374.555200, 12.249900],
'WONB29_2': [358.794500, 380.750300, 12.032600],
'WONB29_B14': [354.378200, 364.821200, 12.140300],
'WONB29_3': [364.889800, 374.659600, 12.184300],
'WONB28_B7': [305.226100, -171.613600, 7.653700],
'WONB28_5': [312.679900, -175.901700, 8.170200],
'WONB28_B1': [320.777200, -166.815200, 8.369800],
'WONB28_B13': [313.191700, -184.751300, 8.182000],
'WONB28': [321.243900, -175.481100, 8.381500],
'WONB28_1': [329.341400, -166.428800, 8.217800],
'WONB28_2': [329.903300, -175.229000, 8.213900],
'WONB28_3': [330.411900, -183.950200, 8.222700],
'WONB24_3': [-13.517100, 460.903900, 0.455200],
'WONB24_B15': [-22.397400, 453.870400, 0.596700],
'WONB24_2': [-19.069300, 467.385700, 0.418700],
'WONB24': [-25.504500, 461.825500, 0.442600],
'WONB24_5': [-32.006300, 456.181700, 0.052400],
'WONB24_B6': [-40.479300, 457.727800, -0.333100],
'WONB24_1': [-24.724600, 473.932000, 0.199500],
'WONB24_B1': [-31.326700, 468.226300, 0.491800],
'2': [-207.297300, 243.371100, -4.281900],
'23': [203.119900, 50.681900, 50.753600],
'44': [40.714900, 208.535200, 45.466700],
'45': [232.145300, 160.338900, 50.847400],
'46': [41.522300, 209.366900, 2.013500],
'47': [234.074900, 161.053800, 6.809200],
'48': [212.677100, 168.701200, 5.967900],
'52': [206.972100, 49.370100, 6.600600]
}

var pointsInPhoto = {}

// photo size
photoSize = [3328, 1872].map(function(s){ return s * 0.0014 / 2 })

// object save colinearity solver for each photo. 
var solvers = {}

for (var i in eops) {
    solvers[i] = new ColinearityEquation(eops[i], iop)
    pointsInPhoto[i] = {}
    for (var j in points) {
        // equal to solvers[i](points[j][0], points[j][1], points[j][2])
        var vec = solvers[i].groundToPhoto(points[j])

        // test if point inside photo. 
        if (
            Math.abs(vec[0]) <= photoSize[0] &&
            Math.abs(vec[1]) <= photoSize[1]
        ) {
            pointsInPhoto[i][j] = vec
        }
    }
}

function createIcfTable(data) {
    return data
        .split(/\n/g)
        .map(function (row) {
            return row.split(/\s+/g).map(function (s,i) {
                if (i == 0) return s
                else return Number(s)
            })
        })
}

function createIcfStructure(data) {
    var structure = {}
    data.trim().split(/\n/g).map(function(row){
        return row.split(/\s+/g)
    }).reduce(function(structure, row){
        structure[row[0]] = row.slice(1).map(Number)
        return structure
    },structure)
    return structure
}

photoPointError = {}

// use closure to save filename of image.
function wrapFileName(filename) {

    // function load xxx.icf data
    return function whenIcfRead(err, data) {
        if (err) throw err
        var icfStructure = createIcfStructure(data)
        var icf = filename, jpg = filename.replace(/icf$/,'jpg')
        var pointsError = {}
        for (var point in icfStructure) {
            if (pointsInPhoto[jpg][point]) {
                var diff = pointsInPhoto[jpg][point]
                    .multiply(-1)
                    .add(icfStructure[point])
                pointsError[point] = diff
            }
        }
        photoPointError[jpg] = pointsError
    }
}

for (var jpg in pointsInPhoto) {
    var icf = jpg.replace(/jpg$/,'icf')
    fs.readFile(icf, 'utf8', wrapFileName(icf))
}

// output error in format:
//  pointname   x   y   z   dx  dy  dz
function tableString(jpg) {
    var table = []
    for (var point in photoPointError[jpg]) {
        table.push(
            point + '\t' +
            pointsInPhoto[jpg][point] + '\t' +
            photoPointError[jpg][point]
        )
    }
    return table.join('\n')
}

// output error to file: xxx.err
for (var jpg in pointsInPhoto) {
    fs.writeFile(jpg.replace('jpg','err'), tableString(jpg), 'utf8')
}

exports.pe = photoPointError
exports.prip = pointsInPhoto
exports.createIcfStructure = createIcfTable
exports.tableString = tableString

