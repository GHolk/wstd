// Generated by CoffeeScript 1.12.1
(function() {
  var i, matrix, vector;

  vector = require('vector');

  matrix = (function() {
    var k, results;
    results = [];
    for (i = k = 1; k <= 3; i = ++k) {
      results.push(vector.create());
    }
    return results;
  })();

  matrix.size = [3, 3];

  matrix.create = function() {
    var newMatrix;
    newMatrix = Object.create(this);
    newMatrix.forEach(function(x, i, m) {
      if (i[1] === 0) {
        return m[i[0]] = vector.create();
      }
    });
    return newMatrix;
  };

  matrix.forEach = function(callback) {
    var k, l, ref, ref1, x, y;
    for (y = k = 0, ref = this.size[0]; 0 <= ref ? k < ref : k > ref; y = 0 <= ref ? ++k : --k) {
      for (x = l = 0, ref1 = this.size[1]; 0 <= ref1 ? l < ref1 : l > ref1; x = 0 <= ref1 ? ++l : --l) {
        callback(this[y][x], [y, x], this);
      }
    }
    return void 0;
  };

  matrix.map = function(callback) {
    var m;
    m = matrix.create();
    this.forEach(function(v, i, a) {
      return m[i[0]][i[1]] = callback(v, i, a);
    });
    return m;
  };

  matrix.reduce = function(callback, sum) {
    this.forEach(function(v, i, a) {
      return sum = callback(sum, v, i, a);
    });
    return sum;
  };

  matrix[':'] = function(n) {
    return this.reduce(function(s, v, i) {
      if (i[1] === n) {
        s[i[0]] = v;
      }
      return s;
    }, vector.create());
  };

  matrix.multiply = function(target) {
    if (typeof target === 'number') {
      return this.multiplyScalar(target);
    } else if (target.size && target.size.length === 2) {
      return this.multiplyMatrix(target);
    } else if (target instanceof Array) {
      return this.multiplyVector(target);
    } else {
      throw new Error("not vector or matrix");
    }
  };

  matrix.multiplyMatrix = function(m) {
    return this.map(function(v, i, a) {
      return a[i[0]].dot(m[':'](i[1]));
    });
  };

  matrix.multiplyVector = function(v) {
    return v.map((function(_this) {
      return function(vi, i, v) {
        return _this[i].dot(v);
      };
    })(this));
  };

  matrix.multiplyScalar = function(scalar) {
    return this.map(function(x) {
      return scalar * x;
    });
  };

  matrix.transpose = function() {
    return this.map(function(x, ij, m) {
      return m[ij[1]][ij[0]];
    });
  };

  matrix.add = function(m) {
    return this.map(function(v, i) {
      return v + m[i[0]][i[1]];
    });
  };

  matrix.minus = function(m) {
    return this.add(m.multiply(-1));
  };

  matrix.clone = function() {
    return this.map(function(x) {
      return x;
    });
  };

  matrix.slice = function(start, end) {
    return this.reduce(function(s, v) {
      s.push(v);
      return s;
    }, []).slice(start, end);
  };

  matrix.toString = function() {
    return this.join();
  };

  matrix.join = function(fs, rs) {
    if (fs == null) {
      fs = '\t';
    }
    if (rs == null) {
      rs = '\n';
    }
    return this.reduce(function(s, x, i) {
      switch (false) {
        case !(i[0] === 0 && i[1] === 0):
          return s + x;
        case i[1] !== 0:
          return s + rs + x;
        default:
          return s + fs + x;
      }
    }, '');
  };

  matrix.createFromNumber = function(x) {
    return this.map(function() {
      return x;
    });
  };

  matrix.createIdentity = function() {
    return this.map(function(x, i) {
      if (i[0] === i[1]) {
        return 1;
      } else {
        return 0;
      }
    });
  };

  matrix.createFromArray = function(a) {
    return this.map(function(x, i) {
      return a[i[0] * 3 + i[1]];
    });
  };

  matrix.createFromArray2D = function(a) {
    return this.map(function(x, i) {
      return a[i[0]][i[1]];
    });
  };

  matrix.every = function(callback) {
    return this.reduce(function(t, x, i, m) {
      return t && callback(x, i, m);
    }, true);
  };

  matrix.some = function(callback) {
    return this.reduce(function(t, x, i, m) {
      return t || callback(x, i, m);
    }, false);
  };

  matrix.equal = function(m, error) {
    if (error == null) {
      error = 1e-5;
    }
    return this.minus(m).every(function(x) {
      return Math.abs(x) <= error;
    });
  };

  matrix.det = function() {
    var left, mod, right;
    mod = function(s) {
      return ((s % 3) + 3) % 3;
    };
    right = this.reduce(function(a, x, i) {
      var j;
      j = mod(i[1] - i[0]);
      a[j] *= x;
      return a;
    }, [1, 1, 1]).reduce((function(s, x) {
      return s + x;
    }), 0);
    left = this.reduce(function(a, x, i) {
      var j;
      j = mod(i[1] + i[0]);
      a[j] *= x;
      return a;
    }, [1, 1, 1]).reduce((function(s, x) {
      return s + x;
    }), 0);
    return right - left;
  };

  matrix.constructor = matrix.create;

  matrix.create.prototype = matrix;

  if (module && module.exports) {
    module.exports = matrix;
  } else if (window) {
    window.matrix = matrix;
  }

}).call(this);
