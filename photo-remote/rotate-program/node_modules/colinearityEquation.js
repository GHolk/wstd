// Generated by CoffeeScript 1.12.1
(function() {
  var ColinearityEquation, matrix, rotateMatrix, vector;

  switch (false) {
    case !require:
      vector = require('vector');
      matrix = require('matrix');
      rotateMatrix = require('rotateMatrix');
      break;
    case !window:
      vector = window.vector;
      matrix = window.matrix;
      rotateMatrix = rotateMatrix;
  }

  ColinearityEquation = (function() {
    function ColinearityEquation(parameter, interiorOrientalParameter) {
      var c, kappa, omega, phi, xo, xp, yo, yp, zo;
      c = parameter.c, xp = parameter.xp, yp = parameter.yp, omega = parameter.omega, phi = parameter.phi, kappa = parameter.kappa, xo = parameter.xo, yo = parameter.yo, zo = parameter.zo;
      this.groundToPhotoMatrix = rotateMatrix.wfk(omega, phi, kappa);
      this.photoToGroundMatrix = this.groundToPhotoMatrix.transpose();
      this.cameraInSpaceVector = vector.createFromArray([xo, yo, zo]);
      this.cameraToPhotoVector = interiorOrientalParameter || vector.createFromArray([xp, yp, c]);
    }

    ColinearityEquation.prototype.groundToPhoto = function(groundPointVector) {
      var scale, unScaleVector;
      if (!groundPointVector instanceof vector.create) {
        groundPointVector = vector.createFromArray(groundPointVector);
      }
      unScaleVector = this.groundToPhotoMatrix.multiply(groundPointVector.minus(this.cameraInSpaceVector));
      scale = -this.cameraToPhotoVector[2] / unScaleVector[2];
      return unScaleVector.multiply(scale).add(this.cameraToPhotoVector);
    };

    ColinearityEquation.prototype.photoToGround = function(photoPoint, groundPointVector) {
      var cameraToPointInGroundVector, photoPointVector, scale, unScaleVector;
      if (groundPointVector == null) {
        groundPointVector = vector.createFromArray([0/0, 0/0, 0]);
      }
      photoPointVector = photoPoint instanceof vector.create ? photoPoint : vector.createFromArray(photoPoint);
      unScaleVector = this.photoToGroundMatrix.multiply(photoPointVector.minus(this.cameraToPhotoVector).multiply(-1));
      cameraToPointInGroundVector = groundPointVector.minus(this.cameraInSpaceVector);
      scale = unScaleVector.reduce(function(s, x, i, m) {
        if (s) {
          return s;
        } else {
          return x / cameraToPointInGroundVector[i];
        }
      }, 0/0);
      return unScaleVector.multiply(1 / scale).add(this.cameraInSpaceVector);
    };

    return ColinearityEquation;

  })();

  switch (false) {
    case !(module && module.exports):
      module.exports = ColinearityEquation;
      break;
    case !exports:
      exports.colinearitySolverGenerator = ColinearityEquation;
      break;
    case !window:
      window.colinearitySolverGenerator = ColinearityEquation;
  }

}).call(this);
