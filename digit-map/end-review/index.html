<!DOCTYPE HTML>
<html lang="zh-TW" prefix="og: http://ogp.me/ns#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="author" property="og:article:author" content="c34031328">
<meta name="copyright" content="Common Creative, by c34031328">
<meta name="generator" content="vim">
<!-- 以上一般不用改，以下才要改。 -->

<!-- 後設資料 -->
<meta name="date" property="og:article:public_time" content="2017-06-07"> 
<meta name="keywords" property="og:article:tag" content="digital-map,gis,question-answer">

<!-- 和網頁位置有關 -->
<link rel="stylesheet" type="text/css" href="https://gholk.github.io/ext/word.css">
<style>
h1 { conuter-reset: question-counter; }
h2 { counter-increment: question-counter; }
h2:before { content: counter(question-counter) ". "; }
</style>

<title>數值製圖 期末作業</title>
</head>
<body>
<main>
<h1>數值製圖 期末作業</h1>
<p>數值製圖的期末作業，
大概就是把整學期的上課內容複習過一遍。</p>
<h2>等高線數化</h2>
<p>今有五千分之一等高線線繪圖大小約 A4、一台 300 dpi 平台式掃描儀、一台
Calcomp 1000 dpi 數化板,請問你要採用數化法或掃描法產生等高線 GIS 圖與
DTM?請詳細說明處理流程,並說明 DTM 成果可能誤差來源與大小?</p>
<p>個人沒有使用過數化板，如果有手冊可以嘗試看看。
會使用掃描儀掃成圖片，依 <a href="../digitize-contour/">作業一數化等高線</a> 的流程處理；
這裡只列出大綱：</p>
<ol>
<li><p>使用平台式掃描儀掃描原圖為影像檔，
若紙圖過大無法一次掃描，則分成幾個部份掃。</p>
</li>
<li><p>將影像檔讀取到 GIS 軟體內，
並以其中網格點進行幾何改正，消除掃描可能造成的誤差。
若有多個部份，也在此時一同匯入到 GIS 軟體內改正。</p>
</li>
<li><p>匯出成完整的地圖影像檔，使用影像處理軟體如 GIMP 處理。
因為等高線顏色相同，使用依顏色選取即可選取出等高線，
匯出一張只有等高線的影像。</p>
</li>
<li><p>使用 autotrace 或其它將點陣圖轉為向量圖的軟體，
將等高線點陣圖轉為向量圖。</p>
<p>這步可能會使點陣圖的位置資訊遺失，如果要保險，
可以在上一步保留等高線外也保留方格網。</p>
</li>
<li><p>將向量圖匯回 GIS 軟體內，並手動為每條等高線標上高程。
若向量圖沒有位置資訊，可以利用方格網再進行對位一次。</p>
</li>
<li><p>使用內差工具，由等高線內插出 DTM 。</p>
</li>
</ol>
<h3>誤差來源</h3>
<ul>
<li>地圖的等高線也只是內插出來的，沒有多準。</li>
<li>掃描的幾何誤差，只能用方格網內插法改正，不能完全消除。</li>
<li>點陣圖中線條有寬度，轉為無寬度的向量圖時可能失真。</li>
<li>由等高線內插出 DTM 時，有多種內插方法，各產出不同的結果。</li>
</ul>
<h2>製做 LOD-2 房屋模型</h2>
<p>請說明利用高解析 DSM 與真實正射影像製作 LOD-2 房屋模型之程序、
可能遭遇之問題與誤差來源?</p>
<p>利用真實正射影像數化出房屋邊界與屋頂，
每個端點都要數化到。
再利用 DSM 取得每個端點的高程，
重建出 LOD-2 模型。</p>
<p>由於只有正射影像，無法獲得牆面資訊，
只能隨便從資料庫抓一些牆面紋理出來貼。</p>
<p>由於端點都是在有高低落差的地方，
在 DSM 上取該點高度稍有誤差就會從屋頂取到地面上。</p>
<h2>產製三角網</h2>
<p>請說明 Incremental 與 Radial Sweep
兩種產製 Delaunay Triangulation 演算法。</p>
<p>三角網是將平面上任意點
變成由多個三角形組成的平面。
三角網不唯一，這裡依據 delaunay triangulation
原則計算一種唯一的三角網。</p>
<p>delaunay 三角網是讓每個三角形的周長為最小，
或任一三角形的外接圓不包含其它點。</p>
<h3>radial sweep</h3>
<p>一種靜態三角網演算法。
需要每點位置都確認後，才能開始計算，
也就不能在基於舊的網，
插入新點後成為新網，需要重新計算。</p>
<ol>
<li><p>計算出所有點的凸包。</p>
</li>
<li><p>為凸包的所有點順時針或逆時針編號，
選任一點 (a) 和該點下一點 (b) 間的邊作為基邊。</p>
</li>
<li><p>找到與該邊最近的一點 (c) ，形成一個三角形。</p>
</li>
<li><p>將該點與原始點 (a) 的連線視為新的基邊，
找到新的點 (d) 形成又一個三角形。</p>
</li>
<li><p>若 (d) 不在凸包邊界上，則重覆部驟 3 。</p>
</li>
<li><p>若 (d) 在凸包邊界上，則結束並更新凸包成最小的凸包，
再重覆部驟 2 。</p>
</li>
</ol>
<h3>incremental sweep</h3>
<p>一種動態三角網演算法，可以隨時加入新點，
之後用此演算法再從原本的三角網擴展成新的網。</p>
<ol>
<li><p>需要至少由一個三角形組成的初始三角網。</p>
</li>
<li><p>對任意一個新點，如果在原始的網內，則和包含她的三角形三點相接。</p>
</li>
<li><p>若在網外，則和最近的二點相接。</p>
</li>
<li><p>將所有點加入。</p>
</li>
<li><p>對所有新增的三角形和其相鄰的三角形組成的四邊形，
計算該四邊形內二三角形是否符合 delaunay ，
若不符合則改為連結另外二點。</p>
</li>
<li><p>對所有經過部驟 5 改動過的三角形
相鄰的三角形也做部驟 5 的檢查。</p>
</li>
</ol>
<h2>路徑簡化</h2>
<p>請說明平行管與 Douglas-Peucker 兩種縮編演算法之流程?
若欲從 1/1000 地形圖縮編成 1/5000 地形圖,
其縮編條件或誤差容許值該如何設定?</p>
<h3>Douglas-Peucker</h3>
<ol>
<li>設定最大容許誤差。</li>
<li>將首尾相連為一直線。</li>
<li>找出離直線最遠的折點。</li>
<li>若折點與直線距離小於容許誤差，則結束。</li>
<li>否則首點與折點、折點與尾點，作兩直線。</li>
<li>對二直線分別進行步驟 3 。</li>
</ol>
<h3>平行管</h3>
<ol>
<li>設定最大容許誤差。</li>
<li>用最少條直線擬合折線，</li>
<li>並折點與直線的距離需小於容許誤差。</li>
<li>可以取直線的交點，或直線交會處的折點進行簡化。</li>
</ol>
<h3>容許誤差</h3>
<p>肉眼可分辨誤差約為 0.5mm ，換算後分別為 0.5m 與 2.5m 。
最小可以分別設定為 0.5m 與 2.5m 。</p>
<p>而紙圖成圖時，線條粗細也會影響。
若主要幹道畫成 5mm 寬，
主要幹道的容許誤差可以是 2.5mm ，
也就是實際的 2.5m 與 12.5m 。</p>
<h2>資料模型</h2>
<p>請比較向量、網格、物件導向三種數值地圖資料模型之優缺點?</p>
<h3>向量與網格</h3>
<p>向量式模型是記錄幾何特徵。
記錄一個圓、圓的半徑、圓的中心；
折線的每個折點位置。</p>
<p>而網格是用一樣的單元記錄現象。
如果是記錄高程，就是一個很大的矩陣，
每一個元素是一個格子，記錄對應點的高程。</p>
<p>相比向量式資料，網格資料不能內嵌屬性資料，
因為網格式資料是均質的，只能記錄每個格子內部如何，
而沒有 <em>這些格子是同一區域，是同一棟房屋</em> 的概念。
向量式資料則可以為每個幾何形狀加上屬性，
因為每個形狀都是獨立的。</p>
<p>網格資料如果過度放大，會有鋸齒的現象。
向量資料則不會，但這不代表向量資料不會失真。
如果當初建置向量資料，要求的精度只到公尺等級，
雖然理論上向量資料可以無限放大，
但放大的結果不代表地物就真得在該點上。</p>
<h3>物件導向</h3>
<p>其實向量資料已經有一點物件導向的概念，
將一個個形狀視為物件，並可以擁有屬性，
像 arcgis 的 shape file 。</p>
<p>對外，物件包裝了內部的實作細節。
例如讀取線段長度時，
傳統需要先判斷線段是弧線或折線。
弧線則要讀取圓心、圓心角、半徑，再行計算；
折線需依序讀取每個折點的座標，再一一計算距離。</p>
<p>對物件導向而言，
則用一個介面統一定義了線段這個父類所有的屬性與方法，
各子類再自行依照內部的資料結構，
實作出對應的方法，計算各自的屬性。</p>
<p>優點是架構完整，可擴展性高。
缺點是實作複雜，常必須配合軟體使用。</p>
<h2>Morton 編碼</h2>
<p>請圖解說明 Morton(4,11,13)與 dMorton(3,133)兩函數之結果?</p>
<p><img src="morton-4.svg" alt="圖解 morton(4,11,13)"></p>
<pre><code>11 (10) = 1011 (2)
13 (10) = 1101 (2)
Morton(4,11,13) = 11100111 (2) = 3213 (4) = 231 (10)

dMorton(3,133) = dMorton(3, 10000101 (2)) = dMorton(3, 2011 (4))
i = 0011 (2) = 3 (10)
j = 1000 (2) = 8 (10)
</code></pre><h2>空載傾斜攝影自動牆面紋理貼圖</h2>
<p>請說明利用空載傾斜攝影進行自動化牆面紋理貼圖之程序與相關演算法?</p>
<p>假設空載傾斜攝影影像內外方位參數已知，
欲貼圖的一建物牆面座標、朝向也已知。</p>
<h3>可視性分析</h3>
<ol>
<li>利用投影，判斷該建物有無在影像範圍內。</li>
<li>利用牆面的法向量，判斷牆面是否面向相機。</li>
<li>利用 point-in-polygon 與 line-intersection
演算法，判斷牆面被遮蔽範圍。</li>
</ol>
<h3>貼圖</h3>
<p>確定建物與影像中牆面的對應關係，
即可用反投影法將影像中紋理投影到模型上。</p>
<p>若同一建物被不同影像照到，
會因為各影像亮度不同，造成色差，
可以平均亮度後再貼。</p>
<h2>Ladybug 紋理貼圖</h2>
<p>請說明以測繪車+Ladybug3 全景相機進行牆面紋理貼圖之程序與相關演算法?</p>
<p>ladybug 搭配測繪車，用直接地理定位取得車子的位置資訊，
再透過濾定取得相機各鏡頭和車子的平移關係，得到外方位元素。
內方位元素則透過相機濾定取得。</p>
<p>貼圖有多種演算法：</p>
<ol>
<li>從影像投影回牆面。</li>
<li>用雙線性內插法，
從該影像範圍內差建物牆面上一點的 RGB 值。</li>
</ol>
<h2>空載光達</h2>
<p>請說明空載光達之測量原理、系統率定內容,並分析其誤差來源?</p>
<h3>光達位置</h3>
<p>利用直接地理定位，用 DGPS 和地面基站
可以取得精準位置，用 IMU 可以取得姿態。
而 GPS 和 IMU 和光達之間又有位置、姿態差異，
要透過測量或濾定取得 level-on 的值。</p>
<p>或用搭配航拍，用空中三角測量解算位置。</p>
<h3>光達測量</h3>
<p>光達原理是朝某方位發出脈衝光，再測量回波時間。
由發出方向可以得到該點方位，
由回波時間可以得到距離。
因此可以得到該點和光達的相對位置。
再加上光達本身在空間中的位置，就能得到該點的絕對位置。</p>
<h3>系統濾定</h3>
<p>GPS 、 IMG 、 光達間的 level-on 可以透過系統濾定得到。</p>
<h3>誤差來源</h3>
<ul>
<li>光達的測距可能有相對誤差，和距離成正比。</li>
<li>IMU 隨著運作時間會逐漸累積誤差。</li>
</ul>
<h2>三維房屋結構線</h2>
<p>請說明利用三維房屋結構線重建 LOD-2 房屋模型之邏輯、
程序與產生結構線之方法?</p>
<ol>
<li><p>由正射影像數化結構線。</p>
</li>
<li><p>找出獨立的結構線，也就是高度唯一確定的線。
不獨立的線是指從正上方看來是一條，但其實兩端是有高度差的。</p>
</li>
<li><p>確定獨立結構線的高度。</p>
</li>
<li><p>用相接的獨立結構線確定不獨立的結構線，使之也有確定的高度。</p>
</li>
<li><p>重覆用已知高度的結構線確定未知的，直到所有結構線高度已知。</p>
</li>
</ol>

</main>

<pre class="markdown raw">
# 數值製圖 期末作業 #

數值製圖的期末作業，
大概就是把整學期的上課內容複習過一遍。

## 等高線數化 ##
今有五千分之一等高線線繪圖大小約 A4、一台 300 dpi 平台式掃描儀、一台
Calcomp 1000 dpi 數化板,請問你要採用數化法或掃描法產生等高線 GIS 圖與
DTM?請詳細說明處理流程,並說明 DTM 成果可能誤差來源與大小?

個人沒有使用過數化板，如果有手冊可以嘗試看看。
會使用掃描儀掃成圖片，依 [作業一數化等高線][] 的流程處理；
這裡只列出大綱：

[作業一數化等高線]: ../digitize-contour/

 1. 使用平台式掃描儀掃描原圖為影像檔，
    若紙圖過大無法一次掃描，則分成幾個部份掃。

 2. 將影像檔讀取到 GIS 軟體內，
    並以其中網格點進行幾何改正，消除掃描可能造成的誤差。
    若有多個部份，也在此時一同匯入到 GIS 軟體內改正。

 3. 匯出成完整的地圖影像檔，使用影像處理軟體如 GIMP 處理。
    因為等高線顏色相同，使用依顏色選取即可選取出等高線，
    匯出一張只有等高線的影像。

 4. 使用 autotrace 或其它將點陣圖轉為向量圖的軟體，
    將等高線點陣圖轉為向量圖。

    這步可能會使點陣圖的位置資訊遺失，如果要保險，
    可以在上一步保留等高線外也保留方格網。

 5. 將向量圖匯回 GIS 軟體內，並手動為每條等高線標上高程。
    若向量圖沒有位置資訊，可以利用方格網再進行對位一次。

 6. 使用內差工具，由等高線內插出 DTM 。

### 誤差來源 ###

  - 地圖的等高線也只是內插出來的，沒有多準。
  - 掃描的幾何誤差，只能用方格網內插法改正，不能完全消除。
  - 點陣圖中線條有寬度，轉為無寬度的向量圖時可能失真。
  - 由等高線內插出 DTM 時，有多種內插方法，各產出不同的結果。


## 製做 LOD-2 房屋模型 ##
請說明利用高解析 DSM 與真實正射影像製作 LOD-2 房屋模型之程序、
可能遭遇之問題與誤差來源?

利用真實正射影像數化出房屋邊界與屋頂，
每個端點都要數化到。
再利用 DSM 取得每個端點的高程，
重建出 LOD-2 模型。

由於只有正射影像，無法獲得牆面資訊，
只能隨便從資料庫抓一些牆面紋理出來貼。

由於端點都是在有高低落差的地方，
在 DSM 上取該點高度稍有誤差就會從屋頂取到地面上。


## 產製三角網 ##
請說明 Incremental 與 Radial Sweep
兩種產製 Delaunay Triangulation 演算法。

三角網是將平面上任意點
變成由多個三角形組成的平面。
三角網不唯一，這裡依據 delaunay triangulation
原則計算一種唯一的三角網。

delaunay 三角網是讓每個三角形的周長為最小，
或任一三角形的外接圓不包含其它點。

### radial sweep ###
一種靜態三角網演算法。
需要每點位置都確認後，才能開始計算，
也就不能在基於舊的網，
插入新點後成為新網，需要重新計算。

 1. 計算出所有點的凸包。

 2. 為凸包的所有點順時針或逆時針編號，
    選任一點 (a) 和該點下一點 (b) 間的邊作為基邊。
 
 3. 找到與該邊最近的一點 (c) ，形成一個三角形。

 4. 將該點與原始點 (a) 的連線視為新的基邊，
    找到新的點 (d) 形成又一個三角形。

 5. 若 (d) 不在凸包邊界上，則重覆部驟 3 。

 6. 若 (d) 在凸包邊界上，則結束並更新凸包成最小的凸包，
    再重覆部驟 2 。

### incremental sweep ###
一種動態三角網演算法，可以隨時加入新點，
之後用此演算法再從原本的三角網擴展成新的網。

 1. 需要至少由一個三角形組成的初始三角網。

 2. 對任意一個新點，如果在原始的網內，則和包含她的三角形三點相接。

 3. 若在網外，則和最近的二點相接。

 4. 將所有點加入。

 5. 對所有新增的三角形和其相鄰的三角形組成的四邊形，
    計算該四邊形內二三角形是否符合 delaunay ，
    若不符合則改為連結另外二點。

 6. 對所有經過部驟 5 改動過的三角形
    相鄰的三角形也做部驟 5 的檢查。

## 路徑簡化 ##
請說明平行管與 Douglas-Peucker 兩種縮編演算法之流程?
若欲從 1/1000 地形圖縮編成 1/5000 地形圖,
其縮編條件或誤差容許值該如何設定?

### Douglas-Peucker ###
 1. 設定最大容許誤差。
 2. 將首尾相連為一直線。
 3. 找出離直線最遠的折點。
 4. 若折點與直線距離小於容許誤差，則結束。
 5. 否則首點與折點、折點與尾點，作兩直線。
 6. 對二直線分別進行步驟 3 。

### 平行管 ###
 1. 設定最大容許誤差。
 2. 用最少條直線擬合折線，
 3. 並折點與直線的距離需小於容許誤差。
 4. 可以取直線的交點，或直線交會處的折點進行簡化。

### 容許誤差 ###
肉眼可分辨誤差約為 0.5mm ，換算後分別為 0.5m 與 2.5m 。
最小可以分別設定為 0.5m 與 2.5m 。

而紙圖成圖時，線條粗細也會影響。
若主要幹道畫成 5mm 寬，
主要幹道的容許誤差可以是 2.5mm ，
也就是實際的 2.5m 與 12.5m 。


## 資料模型 ##
請比較向量、網格、物件導向三種數值地圖資料模型之優缺點?

### 向量與網格 ###

向量式模型是記錄幾何特徵。
記錄一個圓、圓的半徑、圓的中心；
折線的每個折點位置。

而網格是用一樣的單元記錄現象。
如果是記錄高程，就是一個很大的矩陣，
每一個元素是一個格子，記錄對應點的高程。

相比向量式資料，網格資料不能內嵌屬性資料，
因為網格式資料是均質的，只能記錄每個格子內部如何，
而沒有 *這些格子是同一區域，是同一棟房屋* 的概念。
向量式資料則可以為每個幾何形狀加上屬性，
因為每個形狀都是獨立的。

網格資料如果過度放大，會有鋸齒的現象。
向量資料則不會，但這不代表向量資料不會失真。
如果當初建置向量資料，要求的精度只到公尺等級，
雖然理論上向量資料可以無限放大，
但放大的結果不代表地物就真得在該點上。

### 物件導向 ###
其實向量資料已經有一點物件導向的概念，
將一個個形狀視為物件，並可以擁有屬性，
像 arcgis 的 shape file 。

對外，物件包裝了內部的實作細節。
例如讀取線段長度時，
傳統需要先判斷線段是弧線或折線。
弧線則要讀取圓心、圓心角、半徑，再行計算；
折線需依序讀取每個折點的座標，再一一計算距離。

對物件導向而言，
則用一個介面統一定義了線段這個父類所有的屬性與方法，
各子類再自行依照內部的資料結構，
實作出對應的方法，計算各自的屬性。

優點是架構完整，可擴展性高。
缺點是實作複雜，常必須配合軟體使用。


## Morton 編碼 ##
請圖解說明 Morton(4,11,13)與 dMorton(3,133)兩函數之結果?

![圖解 morton(4,11,13)](morton-4.svg)

    11 (10) = 1011 (2)
    13 (10) = 1101 (2)
    Morton(4,11,13) = 11100111 (2) = 3213 (4) = 231 (10)

    dMorton(3,133) = dMorton(3, 10000101 (2)) = dMorton(3, 2011 (4))
    i = 0011 (2) = 3 (10)
    j = 1000 (2) = 8 (10)


## 空載傾斜攝影自動牆面紋理貼圖 ##
請說明利用空載傾斜攝影進行自動化牆面紋理貼圖之程序與相關演算法?

假設空載傾斜攝影影像內外方位參數已知，
欲貼圖的一建物牆面座標、朝向也已知。

### 可視性分析 ###
 1. 利用投影，判斷該建物有無在影像範圍內。
 2. 利用牆面的法向量，判斷牆面是否面向相機。
 3. 利用 point-in-polygon 與 line-intersection
    演算法，判斷牆面被遮蔽範圍。

### 貼圖 ###
確定建物與影像中牆面的對應關係，
即可用反投影法將影像中紋理投影到模型上。

若同一建物被不同影像照到，
會因為各影像亮度不同，造成色差，
可以平均亮度後再貼。


## Ladybug 紋理貼圖 ##
請說明以測繪車+Ladybug3 全景相機進行牆面紋理貼圖之程序與相關演算法?

ladybug 搭配測繪車，用直接地理定位取得車子的位置資訊，
再透過濾定取得相機各鏡頭和車子的平移關係，得到外方位元素。
內方位元素則透過相機濾定取得。

貼圖有多種演算法：
 1. 從影像投影回牆面。
 2. 用雙線性內插法，
    從該影像範圍內差建物牆面上一點的 RGB 值。


## 空載光達 ##
請說明空載光達之測量原理、系統率定內容,並分析其誤差來源?

### 光達位置 ###
利用直接地理定位，用 DGPS 和地面基站
可以取得精準位置，用 IMU 可以取得姿態。
而 GPS 和 IMU 和光達之間又有位置、姿態差異，
要透過測量或濾定取得 level-on 的值。

或用搭配航拍，用空中三角測量解算位置。

### 光達測量 ###
光達原理是朝某方位發出脈衝光，再測量回波時間。
由發出方向可以得到該點方位，
由回波時間可以得到距離。
因此可以得到該點和光達的相對位置。
再加上光達本身在空間中的位置，就能得到該點的絕對位置。

### 系統濾定 ###
GPS 、 IMG 、 光達間的 level-on 可以透過系統濾定得到。

### 誤差來源 ###
  - 光達的測距可能有相對誤差，和距離成正比。
  - IMU 隨著運作時間會逐漸累積誤差。


## 三維房屋結構線 ##
請說明利用三維房屋結構線重建 LOD-2 房屋模型之邏輯、
程序與產生結構線之方法?

 0. 由正射影像數化結構線。

 1. 找出獨立的結構線，也就是高度唯一確定的線。
    不獨立的線是指從正上方看來是一條，但其實兩端是有高度差的。

 2. 確定獨立結構線的高度。

 3. 用相接的獨立結構線確定不獨立的結構線，使之也有確定的高度。

 4. 重覆用已知高度的結構線確定未知的，直到所有結構線高度已知。

</pre>

<footer></footer>
<script src="https://gholk.github.io/ext/luser-meta.js" defer></script>
<script src="https://gholk.github.io/ext/luser-anchor-qrcode.js" defer></script>

</body>
</html>

